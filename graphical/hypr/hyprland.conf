# vi: et sw=4

# Refer to https://wiki.hyprland.org/Configuring/Variables/

################
### MONITORS ###
################

# See https://wiki.hyprland.org/Configuring/Monitors/
monitor = , preferred, auto, auto

###############
### PLUGINS ###
###############

plugin = /run/current-system/sw/lib/libhy3.so
plugin = /run/current-system/sw/lib/libhypr-dynamic-cursors.so

#################
### AUTOSTART ###
#################

exec-once = systemctl --user import-environment DISPLAY WAYLAND_DISPLAY HYPRLAND_INSTANCE_SIGNATURE
exec-once = @DOTFILES@/graphical/wl-autostart

#####################
### LOOK AND FEEL ###
#####################

# https://wiki.hyprland.org/Configuring/Variables/#general
general {
    border_size = 1
    # No gaps
    gaps_in = 0
    gaps_out = 0

    # https://wiki.hyprland.org/Configuring/Variables/#variable-types for info about colors
    col.active_border = rgba(5388ffee) rgba(0053aaee) 45deg
    col.inactive_border = rgba(505050ee) 45deg

    layout = hy3
    # Mouse resize
    resize_on_border = true
}

# https://wiki.hyprland.org/Configuring/Variables/#decoration
decoration {
    rounding = 2

    shadow {
        enabled = true
        range = 4
        render_power = 3
        color = rgba(1a1a1aee)
    }

    # https://wiki.hyprland.org/Configuring/Variables/#blur
    blur {
        enabled = true
        size = 3
        passes = 1

        vibrancy = 0.1696
    }
}

# https://wiki.hyprland.org/Configuring/Variables/#animations
animations {
    enabled = yes, please :)

    # Default animations, see https://wiki.hyprland.org/Configuring/Animations/ for more

    bezier = easeOutQuint, 0.23, 1, 0.32, 1
    bezier = easeInOutCubic, 0.65, 0.05, 0.36, 1
    bezier = linear, 0, 0, 1, 1
    bezier = almostLinear, 0.5, 0.5, 0.75, 1.0
    bezier = quick, 0.15, 0, 0.1, 1

    animation = global, 1, 10, default
    animation = border, 1, 5.39, easeOutQuint
    animation = windows, 1, 4.79, easeOutQuint
    animation = windowsIn, 1, 4.1, easeOutQuint, popin 87%
    animation = windowsOut, 1, 1.49, linear, popin 87%
    animation = fadeIn, 1, 1.73, almostLinear
    animation = fadeOut, 1, 1.46, almostLinear
    animation = fade, 1, 3.03, quick
    animation = layers, 1, 3.81, easeOutQuint
    animation = layersIn, 1, 4, easeOutQuint, fade
    animation = layersOut, 1, 1.5, linear, fade
    animation = fadeLayersIn, 1, 1.79, almostLinear
    animation = fadeLayersOut, 1, 1.39, almostLinear
    animation = workspaces, 1, 1.94, almostLinear, fade
    animation = workspacesIn, 1, 1.21, almostLinear, fade
    animation = workspacesOut, 1, 1.94, almostLinear, fade
}

# https://wiki.hyprland.org/Configuring/Variables/#misc
misc {
    force_default_wallpaper = 0 # Set to 0 or 1 to disable the anime mascot wallpapers
    vrr = 3 # Enable VRR for videos/games
    focus_on_activate = true
    font_family = IBM Plex Sans Bol
}

plugin {
    hy3 {
        node_collapse_policy = 0
        tab_first_window = true
        autotile {
            enable = true
        }
        tabs {
            height = 20
            padding = 0
            border_width = 1
            blur = false

            text_center = true
            text_font = IBM Plex Sans Bold

            col.active = rgba(1b68c6aa)
            col.active.border = rgba(ffffffaa)
            col.inactiveMonitor = rgba(78aeedaa)
            col.inactive = rgba(2b303b80)
        }
    }
    dynamic-cursors {
        mode = tilt
        threshold = 4
        shake {
            enabled = true
            threshold = 6.0
            base = 2.0
            effects = true
        }
    }
}


#############
### INPUT ###
#############

# https://wiki.hyprland.org/Configuring/Variables/#input
input {
    kb_layout = de
    kb_variant = nodeadkeys
    # Enable compose key
    kb_options = compose:menu
    # Enable numlock
    numlock_by_default = true
    # No follwing the cursor with focus
    follow_mouse = 0
}

###################
### KEYBINDINGS ###
###################

binds {
    workspace_back_and_forth = true
}

# See https://wiki.hyprland.org/Configuring/Binds/ for more
$mainMod = SUPER

# Move focus with mainMod + hjkl and add Alacritty on mod+Return
bind = $mainMod, H, hy3:movefocus, l
bind = $mainMod, L, hy3:movefocus, r
bind = $mainMod, K, hy3:movefocus, u
bind = $mainMod, J, hy3:movefocus, d
bind = $mainMod, Return, focuswindow, class:Alacritty

# Move focused window
bind = $mainMod SHIFT, H, hy3:movewindow, l
bind = $mainMod SHIFT, L, hy3:movewindow, r
bind = $mainMod SHIFT, K, hy3:movewindow, u
bind = $mainMod SHIFT, J, hy3:movewindow, d

# Split current container
bind = $mainMod, T, hy3:changegroup, tab
bind = $mainMod, V, hy3:changegroup, v
bind = $mainMod, B, hy3:changegroup, h

# Toggle fullscreen
bind = $mainMod, F, fullscreen

# Kill focused window
bind = $mainMod, C, killactive

# Mouse on hy3 tabs
bindn = , mouse:272, hy3:focustab, mouse
# Move/resize windows with mainMod + LMB/RMB and dragging
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# Floating stuff
bind = $mainMod SHIFT, Space, togglefloating
bind = $mainMod, Space, hy3:togglefocuslayer

# Lock
bind = $mainMod, G, exec, @DOTFILES@/scripts/hypr-lock

# Switch workspaces with mainMod + [0-9]
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10
bind = $mainMod, I, workspace, previous
bind = $mainMod, O, workspace, next

# Move active window to a workspace with mainMod + SHIFT + [0-9]
bind = $mainMod SHIFT, 1, hy3:movetoworkspace, 1, follow
bind = $mainMod SHIFT, 2, hy3:movetoworkspace, 2, follow
bind = $mainMod SHIFT, 3, hy3:movetoworkspace, 3, follow
bind = $mainMod SHIFT, 4, hy3:movetoworkspace, 4, follow
bind = $mainMod SHIFT, 5, hy3:movetoworkspace, 5, follow
bind = $mainMod SHIFT, 6, hy3:movetoworkspace, 6, follow
bind = $mainMod SHIFT, 7, hy3:movetoworkspace, 7, follow
bind = $mainMod SHIFT, 8, hy3:movetoworkspace, 8, follow
bind = $mainMod SHIFT, 9, hy3:movetoworkspace, 9, follow
bind = $mainMod SHIFT, 0, hy3:movetoworkspace, 10, follow

# Move workspaces
bind = $mainMod SHIFT, I, exec, hyprctl dispatch moveworkspacetomonitor $(hyprctl activeworkspace -j | jq -r .id) l
bind = $mainMod SHIFT, O, exec, hyprctl dispatch moveworkspacetomonitor $(hyprctl activeworkspace -j | jq -r .id) r
bind = $mainMod, S, exec, @DOTFILES@/scripts/hypr-swap

# Rename workspaces
bind = $mainMod, U, exec, @DOTFILES@/scripts/hypr-renameworkspace

# Scratchpad
bind = $mainMod, Q, togglespecialworkspace, magic
bind = $mainMod SHIFT, Q, movetoworkspace, special:magic

# Launchers
bind = $mainMod, R, exec, fuzzel
bind = $mainMod, X, exec, @DOTFILES@/scripts/hypr-windowmenu
bind = $mainMod, Y, exec, flameshot gui
bindl = $mainMod, N, exec, @DOTFILES@/scripts/power-menu

# XF86
bindl = , XF86AudioPlay, exec, busctl --user call org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player PlayPause
bindl = , XF86AudioStop, exec, busctl --user call org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player Pause
bindl = , XF86AudioPrev, exec, busctl --user call org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player Previous
bindl = , XF86AudioNext, exec, busctl --user call org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player Next
bindl = , XF86AudioRaiseVolume, exec, @DOTFILES@/scripts/volume up
bindl = , XF86AudioLowerVolume, exec, @DOTFILES@/scripts/volume down
bindl = , XF86AudioMute, exec, @DOTFILES@/scripts/volume toggle
bindel = , XF86MonBrightnessUp, exec, xbacklight_tee="sudo tee" @DOTFILES@/scripts/xbacklight +
bindel = , XF86MonBrightnessDown, exec, xbacklight_tee="sudo tee" @DOTFILES@/scripts/xbacklight -
bindl = , XF86ScreenSaver, exec, @DOTFILES@/scripts/hypr-lock
# MX Master 3s
bindl = , mouse:275, exec, busctl --user call org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player Previous
bindl = , mouse:276, exec, busctl --user call org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player Next
bindl = , mouse:277, exec, busctl --user call org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player PlayPause
# Mod+Wheel for volume. Swapped for some reason
bindl = $mainMod, mouse_down, exec, @DOTFILES@/scripts/volume up
bindl = $mainMod, mouse_up, exec, @DOTFILES@/scripts/volume down

# Dunst
bind = $mainMod, code:34, exec, dunstctl history-pop # ü
bind = $mainMod, code:47, exec, dunstctl close # ö
bind = $mainMod, code:48, exec, dunstctl action # ä

# Resize mode
bind = $mainMod, E, submap, resize
submap = resize
binde = , L, resizeactive, 10 0
binde = , H, resizeactive, -10 0
binde = , K, resizeactive, 0 -10
binde = , J, resizeactive, 0 10
# Exit this mode
bind = , Escape, submap, reset
bind = , Return, submap, reset
submap = reset

# Passthru mode
bind = $mainMod, P, submap, passthru
submap = passthru
# Exit this mode
bind = $mainMod, Return, submap, reset
submap = reset

##############################
### WINDOWS AND WORKSPACES ###
##############################

# See https://wiki.hyprland.org/Configuring/Window-Rules/ for more
# See https://wiki.hyprland.org/Configuring/Workspace-Rules/ for workspace rules

# Ignore maximize requests from apps. You'll probably like this.
windowrulev2 = suppressevent maximize, class:.*
# No animation when opening the Tlegram media viewer
windowrulev2 = noanim, fullscreen, class:org.telegram.desktop, title:Media viewer
# Fix some dragging issues with XWayland
windowrulev2 = nofocus, class:^$, title:^$, xwayland:1, floating:1, fullscreen:0, pinned:0
# Flameshot fixups
windowrulev2 = noanim, class:^(flameshot)$
windowrulev2 = float, class:^(flameshot)$
windowrulev2 = move 0 0, class:^(flameshot)$
windowrulev2 = pin, class:^(flameshot)$
windowrulev2 = monitor 0, class:^(flameshot)$ # set this to your leftmost monitor id, otherwise you have to move your cursor to the leftmost monitor before executing flameshot
# Fix flameshot pin
windowrulev2 = noborder, class:^(flameshot)$, title:^(flameshot-pin)$
windowrulev2 = noshadow, class:^(flameshot)$, title:^(flameshot-pin)$
windowrulev2 = noblur, class:^(flameshot)$, title:^(flameshot-pin)$
# Force focus on pinentry
windowrulev2 = stayfocused, class:org.gnupg.pinentry-qt
windowrulev2 = dimaround, class:org.gnupg.pinentry-qt

###################
### PERMISSIONS ###
###################

ecosystem {
    enforce_permissions = true
}
permission = /run/current-system/sw/lib/libhy3.so, plugin, allow
permission = /run/current-system/sw/lib/libhypr-dynamic-cursors.so, plugin, allow
permission = /nix/store/[a-z0-9]{32}-grim-[0-9.]*/bin/grim, screencopy, allow
permission = /nix/store/[a-z0-9]{32}-xdg-desktop-portal-hyprland-[0-9.]*/libexec/.xdg-desktop-portal-hyprland-wrapped, screencopy, allow

####################
### LOCAL CONFIG ###
####################

source = @DOTFILES@/local/hyprland.conf
